{% extends 'bibliotheque/base.html' %}
{% load static %}

{% block title %}Dashboard | BiblioSmart{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block extra_css %}
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Lora:wght@600;700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="{% static 'css/style.css' %}">


<style>
/* ================================================================
   DASHBOARD VARIABLES
================================================================ */
:root {
    --db-radius: 14px;
    --db-shadow: 0 2px 12px rgba(15,23,42,0.07);
    --db-shadow-hover: 0 8px 28px rgba(15,23,42,0.13);
    --db-transition: 0.28s cubic-bezier(.4,0,.2,1);
}

/* ================================================================
   WELCOME BANNER
================================================================ */
.welcome-banner {
    background: linear-gradient(120deg, #0f172a 0%, #1e3a5f 55%, #0369a1 100%);
    border-radius: var(--db-radius);
    padding: 32px 36px;
    margin-bottom: 28px;
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
    box-shadow: 0 4px 24px rgba(3,105,161,0.25);
    animation: bannerIn .55s ease both;
}

@keyframes bannerIn {
    from { opacity: 0; transform: translateY(-14px); }
    to   { opacity: 1; transform: translateY(0); }
}

/* Decorative blobs */
.welcome-banner::before,
.welcome-banner::after {
    content: '';
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
}
.welcome-banner::before {
    width: 260px; height: 260px;
    background: rgba(255,255,255,0.04);
    right: -40px; top: -80px;
}
.welcome-banner::after {
    width: 160px; height: 160px;
    background: rgba(56,189,248,0.1);
    right: 180px; bottom: -60px;
}

.welcome-text h1 {
    font-family: 'Lora', serif;
    font-size: 1.75rem;
    font-weight: 700;
    color: #fff;
    margin: 0 0 6px;
    line-height: 1.2;
}

.welcome-text p {
    color: #94d0ef;
    font-size: 0.88rem;
    margin: 0;
    font-weight: 400;
}

.welcome-meta {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 8px;
    z-index: 1;
}

.welcome-badge {
    background: rgba(255,255,255,0.12);
    border: 1px solid rgba(255,255,255,0.18);
    color: #e0f2fe;
    font-size: 0.78rem;
    padding: 5px 14px;
    border-radius: 20px;
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    gap: 6px;
    white-space: nowrap;
}

/* ================================================================
   STAT CARDS
================================================================ */
.stat-cards-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 18px;
    margin-bottom: 28px;
}

@media (max-width: 1200px) { .stat-cards-grid { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 576px)  { .stat-cards-grid { grid-template-columns: 1fr; } }

.stat-card {
    background: #fff;
    border-radius: var(--db-radius);
    padding: 20px 22px;
    box-shadow: var(--db-shadow);
    cursor: pointer;
    transition: transform var(--db-transition), box-shadow var(--db-transition);
    position: relative;
    overflow: hidden;
    animation: cardIn .45s ease both;
}

@keyframes cardIn {
    from { opacity: 0; transform: translateY(18px); }
    to   { opacity: 1; transform: translateY(0); }
}

.stat-card:nth-child(1) { animation-delay: .05s; }
.stat-card:nth-child(2) { animation-delay: .10s; }
.stat-card:nth-child(3) { animation-delay: .15s; }
.stat-card:nth-child(4) { animation-delay: .20s; }
.stat-card:nth-child(5) { animation-delay: .25s; }
.stat-card:nth-child(6) { animation-delay: .30s; }
.stat-card:nth-child(7) { animation-delay: .35s; }
.stat-card:nth-child(8) { animation-delay: .40s; }

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--db-shadow-hover);
}

/* Colored top bar */
.stat-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    border-radius: var(--db-radius) var(--db-radius) 0 0;
}

.stat-card-primary::before   { background: #3b82f6; }
.stat-card-success::before   { background: #22c55e; }
.stat-card-info::before      { background: #06b6d4; }
.stat-card-warning::before   { background: #f59e0b; }
.stat-card-danger::before    { background: #ef4444; }
.stat-card-purple::before    { background: #8b5cf6; }
.stat-card-cyan::before      { background: #0ea5e9; }
.stat-card-teal::before      { background: #14b8a6; }

.stat-card-body {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 14px;
}

.stat-card-icon {
    width: 48px; height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.35rem;
    flex-shrink: 0;
}

.stat-card-primary .stat-card-icon   { background: #eff6ff; color: #3b82f6; }
.stat-card-success .stat-card-icon   { background: #f0fdf4; color: #22c55e; }
.stat-card-info    .stat-card-icon   { background: #ecfeff; color: #06b6d4; }
.stat-card-warning .stat-card-icon   { background: #fffbeb; color: #f59e0b; }
.stat-card-danger  .stat-card-icon   { background: #fef2f2; color: #ef4444; }
.stat-card-purple  .stat-card-icon   { background: #f5f3ff; color: #8b5cf6; }
.stat-card-cyan    .stat-card-icon   { background: #f0f9ff; color: #0ea5e9; }
.stat-card-teal    .stat-card-icon   { background: #f0fdfa; color: #14b8a6; }

.stat-card-info-text { /* renamed to avoid Bootstrap conflict */ }

.stat-card-number {
    font-family: 'Lora', serif;
    font-size: 1.9rem;
    font-weight: 700;
    color: #0f172a;
    line-height: 1;
    margin: 0 0 3px;
}

.stat-card-label {
    font-size: 0.78rem;
    color: #64748b;
    font-weight: 500;
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.06em;
}

.stat-card-footer {
    border-top: 1px solid #f1f5f9;
    padding-top: 10px;
    font-size: 0.76rem;
    color: #94a3b8;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: color var(--db-transition);
}

.stat-card:hover .stat-card-footer { color: #475569; }

/* ================================================================
   ALERT RETARDS
================================================================ */
.retard-alert {
    background: linear-gradient(90deg, #fef2f2, #fff7ed);
    border: 1px solid #fca5a5;
    border-left: 4px solid #ef4444;
    border-radius: var(--db-radius);
    padding: 14px 20px;
    margin-bottom: 28px;
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 0.88rem;
    color: #7f1d1d;
    animation: cardIn .4s ease both;
}

.retard-alert i { font-size: 1.2rem; color: #ef4444; flex-shrink: 0; }
.retard-alert a { color: #ef4444; font-weight: 600; text-decoration: none; }
.retard-alert a:hover { text-decoration: underline; }
.retard-alert .btn-close { margin-left: auto; filter: invert(30%) sepia(80%) saturate(400%) hue-rotate(320deg); }

/* ================================================================
   CHARTS SECTION
================================================================ */
.charts-grid {
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: 20px;
    margin-bottom: 28px;
}

@media (max-width: 992px) { .charts-grid { grid-template-columns: 1fr; } }

.chart-card {
    background: #fff;
    border-radius: var(--db-radius);
    box-shadow: var(--db-shadow);
    overflow: hidden;
    animation: cardIn .5s ease .3s both;
}

.chart-card-header {
    padding: 16px 22px;
    border-bottom: 1px solid #f1f5f9;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
}

.chart-card-header h5 {
    font-size: 0.9rem;
    font-weight: 600;
    color: #1e293b;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 8px;
}

.chart-card-header h5 i { color: #3b82f6; }

.chart-pill {
    font-size: 0.7rem;
    font-weight: 600;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    padding: 4px 10px;
    border-radius: 20px;
    background: #eff6ff;
    color: #3b82f6;
}

.chart-card-body { padding: 20px 22px; }

/* ================================================================
   ACTIVITY TABLE
================================================================ */
.activity-card {
    background: #fff;
    border-radius: var(--db-radius);
    box-shadow: var(--db-shadow);
    overflow: hidden;
    animation: cardIn .5s ease .45s both;
}

.activity-header {
    padding: 16px 22px;
    border-bottom: 1px solid #f1f5f9;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.activity-header h5 {
    font-size: 0.9rem;
    font-weight: 600;
    color: #1e293b;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 8px;
}

.activity-header h5 i { color: #3b82f6; }

.table { margin: 0; }

.table thead th {
    font-size: 0.72rem;
    font-weight: 700;
    letter-spacing: 0.07em;
    text-transform: uppercase;
    color: #94a3b8;
    background: #f8fafc;
    border-bottom: 1px solid #e2e8f0;
    padding: 11px 14px;
    white-space: nowrap;
}

.table tbody td {
    font-size: 0.83rem;
    color: #334155;
    padding: 12px 14px;
    vertical-align: middle;
    border-bottom: 1px solid #f1f5f9;
}

.table tbody tr:last-child td { border-bottom: none; }

.table tbody tr {
    transition: background var(--db-transition);
}

.table tbody tr:hover td { background: #f8fafc; }

/* Badges */
.badge-emprunt   { background: #dcfce7; color: #166534; }
.badge-retour    { background: #e0f2fe; color: #0c4a6e; }
.badge-inscr     { background: #eff6ff; color: #1e40af; }
.badge-actif     { background: #dcfce7; color: #166534; }
.badge-retard    { background: #fee2e2; color: #991b1b; }
.badge-attente   { background: #fef9c3; color: #854d0e; }

.badge-pill {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: 0.72rem;
    font-weight: 600;
    padding: 3px 9px;
    border-radius: 20px;
    white-space: nowrap;
}

/* Action buttons */
.btn-action {
    width: 28px; height: 28px;
    border-radius: 7px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    border: 1px solid #e2e8f0;
    background: #fff;
    color: #64748b;
    text-decoration: none;
    cursor: pointer;
    transition: all var(--db-transition);
    margin: 0 1px;
}

.btn-action:hover.view   { background: #eff6ff; border-color: #bfdbfe; color: #3b82f6; }
.btn-action:hover.edit   { background: #fffbeb; border-color: #fde68a; color: #d97706; }
.btn-action:hover.delete { background: #fef2f2; border-color: #fecaca; color: #ef4444; }

/* Empty state */
.empty-state {
    text-align: center;
    padding: 52px 20px;
    color: #94a3b8;
}

.empty-state i { font-size: 3rem; display: block; margin-bottom: 12px; opacity: 0.4; }
.empty-state p { font-size: 0.88rem; margin: 0; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-0">

    <!-- ── Welcome Banner ───────────────────────────────────────── -->
    <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <button class="btn btn-primary" id="sidebarToggle">
                    <i class="bi bi-list"></i>
                </button>
                <span class="navbar-center ms-2">BiblioSmart</span>
                
                <div class="ms-auto">
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href=""><i class="bi bi-person me-2"></i>Profil</a></li>
                            <li><a class="dropdown-item" href="{% url 'parametrage_dashboard' %}"><i class="bi bi-gear me-2"></i>Paramètres</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="{% url 'logout' %}"><i class="bi bi-box-arrow-right me-2"></i>Déconnexion</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>

    <!-- ── Stat Cards ────────────────────────────────────────────── -->
    <div class="stat-cards-grid">

        <div class="stat-card stat-card-primary" onclick="location.href='{% url 'abonnes' %}'">
            <div class="stat-card-body">
                <div class="stat-card-icon"><i class="bi bi-people"></i></div>
                <div>
                    <h3 class="stat-card-number">{{ total_etudiants|default:0 }}</h3>
                    <p class="stat-card-label">Abonné.e.s</p>
                </div>
            </div>
            <div class="stat-card-footer"><i class="bi bi-arrow-right-circle"></i> Voir la liste</div>
        </div>

        <div class="stat-card stat-card-success" onclick="location.href='{% url 'abonnement_list' %}'">
            <div class="stat-card-body">
                <div class="stat-card-icon"><i class="bi bi-card-checklist"></i></div>
                <div>
                    <h3 class="stat-card-number">{{ total_abonnements|default:0 }}</h3>
                    <p class="stat-card-label">Abonnements</p>
                </div>
            </div>
            <div class="stat-card-footer"><i class="bi bi-arrow-right-circle"></i> Gérer les abonnements</div>
        </div>

        <div class="stat-card stat-card-info" onclick="location.href='{% url 'livre_list' %}'">
            <div class="stat-card-body">
                <div class="stat-card-icon"><i class="bi bi-book"></i></div>
                <div>
                    <h3 class="stat-card-number">{{ total_livres|default:0 }}</h3>
                    <p class="stat-card-label">Livres</p>
                </div>
            </div>
            <div class="stat-card-footer"><i class="bi bi-arrow-right-circle"></i> Consulter le catalogue</div>
        </div>

        <div class="stat-card stat-card-warning" onclick="location.href='{% url 'emprunt_list' %}'">
            <div class="stat-card-body">
                <div class="stat-card-icon"><i class="bi bi-arrow-left-right"></i></div>
                <div>
                    <h3 class="stat-card-number">{{ emprunts_actifs|default:0 }}</h3>
                    <p class="stat-card-label">Emprunts actifs</p>
                </div>
            </div>
            <div class="stat-card-footer"><i class="bi bi-arrow-right-circle"></i> Gérer les emprunts</div>
        </div>

        <div class="stat-card stat-card-purple" onclick="location.href='{% url 'universite_list' %}'">
            <div class="stat-card-body">
                <div class="stat-card-icon"><i class="bi bi-mortarboard"></i></div>
                <div>
                    <h3 class="stat-card-number">{{ total_universites|default:0 }}</h3>
                    <p class="stat-card-label">Universités</p>
                </div>
            </div>
            <div class="stat-card-footer"><i class="bi bi-arrow-right-circle"></i> Liste des universités</div>
        </div>

        <div class="stat-card stat-card-cyan" onclick="location.href='{% url 'auteur_list' %}'">
            <div class="stat-card-body">
                <div class="stat-card-icon"><i class="bi bi-person-lines-fill"></i></div>
                <div>
                    <h3 class="stat-card-number">{{ total_auteurs|default:0 }}</h3>
                    <p class="stat-card-label">Auteurs</p>
                </div>
            </div>
            <div class="stat-card-footer"><i class="bi bi-arrow-right-circle"></i> Liste des auteurs</div>
        </div>

        <div class="stat-card stat-card-danger">
            <div class="stat-card-body">
                <div class="stat-card-icon"><i class="bi bi-exclamation-triangle"></i></div>
                <div>
                    <h3 class="stat-card-number">{{ emprunts_retard|default:0 }}</h3>
                    <p class="stat-card-label">Retards</p>
                </div>
            </div>
            <div class="stat-card-footer"><i class="bi bi-exclamation-circle"></i> Nécessite attention</div>
        </div>

        <div class="stat-card stat-card-teal">
            <div class="stat-card-body">
                <div class="stat-card-icon"><i class="bi bi-cash-coin"></i></div>
                <div>
                    <h3 class="stat-card-number">{{ revenus_mois|default:0 }}</h3>
                    <p class="stat-card-label">Revenus du mois (BIF)</p>
                </div>
            </div>
            <div class="stat-card-footer"><i class="bi bi-graph-up"></i> Ce mois</div>
        </div>

    </div>

    <!-- ── Alerte Retards ─────────────────────────────────────────── -->
    {% if emprunts_retard > 0 %}
    <div class="retard-alert alert-dismissible" role="alert">
        <i class="bi bi-exclamation-triangle-fill"></i>
        <div>
            <strong>Attention !</strong> Vous avez <strong>{{ emprunts_retard }}</strong> emprunt(s) en retard.
            <a href="{% url 'emprunt_list' %}">Voir les détails →</a>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endif %}

    <!-- ── Charts ────────────────────────────────────────────────── -->
    <div class="charts-grid">
        <div class="chart-card">
            <div class="chart-card-header">
                <h5><i class="bi bi-bar-chart-fill"></i> Statistiques mensuelles</h5>
                <span class="chart-pill">12 derniers mois</span>
            </div>
            <div class="chart-card-body">
                <canvas id="monthlyChart" height="90"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <div class="chart-card-header">
                <h5><i class="bi bi-pie-chart-fill"></i> Répartition</h5>
                <span class="chart-pill">Global</span>
            </div>
            <div class="chart-card-body">
                <canvas id="pieChart" height="200"></canvas>
            </div>
        </div>
    </div>

    <!-- ── Activités Récentes ─────────────────────────────────────── -->
    <div class="activity-card">
        <div class="activity-header">
            <h5><i class="bi bi-activity"></i> Activités récentes</h5>
            <a href="{% url 'abonnes' %}" class="btn btn-sm btn-primary d-flex align-items-center gap-1">
                <i class="bi bi-eye"></i> Voir tout
            </a>
        </div>
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th><i class="bi bi-calendar3 me-1"></i> Date</th>
                        <th><i class="bi bi-tag me-1"></i> Type</th>
                        <th><i class="bi bi-person me-1"></i> Abonné.e</th>
                        <th><i class="bi bi-book me-1"></i> Livre</th>
                        <th><i class="bi bi-mortarboard me-1"></i> Université</th>
                        <th><i class="bi bi-circle-fill me-1"></i> Statut</th>
                        <th><i class="bi bi-calendar-check me-1"></i> Retour</th>
                        <th style="text-align:center;"><i class="bi bi-gear me-1"></i> Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for activite in activites_recentes %}
                    <tr>
                        <td>{{ activite.annee_inscription|date:"d/m/Y" }}</td>
                        <td>
                            {% if activite.type == 'emprunt' %}
                                <span class="badge-pill badge-emprunt"><i class="bi bi-arrow-up-circle"></i> Emprunt</span>
                            {% elif activite.type == 'retour' %}
                                <span class="badge-pill badge-retour"><i class="bi bi-arrow-down-circle"></i> Retour</span>
                            {% else %}
                                <span class="badge-pill badge-inscr"><i class="bi bi-person-plus"></i> Inscription</span>
                            {% endif %}
                        </td>
                        <td><strong>{{ activite.etudiant.nom }} {{ activite.etudiant.prenom }}</strong></td>
                        <td>{{ activite.livre|default:"—" }}</td>
                        <td><small class="text-muted">{{ activite.etudiant.universite.nom|truncatewords:3 }}</small></td>
                        <td>
                            {% if activite.statut == 'actif' %}
                                <span class="badge-pill badge-actif"><i class="bi bi-check-circle"></i> Actif</span>
                            {% elif activite.statut == 'retard' %}
                                <span class="badge-pill badge-retard"><i class="bi bi-exclamation-circle"></i> Retard</span>
                            {% else %}
                                <span class="badge-pill badge-attente"><i class="bi bi-clock"></i> En attente</span>
                            {% endif %}
                        </td>
                        <td>{{ activite.date_retour|date:"d/m/Y"|default:"—" }}</td>
                        <td style="text-align:center;">
                            <button class="btn-action view"   title="Voir"><i class="bi bi-eye"></i></button>
                            <button class="btn-action edit"   title="Modifier"><i class="bi bi-pencil"></i></button>
                            <button class="btn-action delete" title="Supprimer"><i class="bi bi-trash"></i></button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8">
                            <div class="empty-state">
                                <i class="bi bi-inbox"></i>
                                <p>Aucune activité récente à afficher.</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
/* ── Date dans la bannière ─────────────────────────────────── */
(function() {
    const el = document.getElementById('bannerDate');
    if (el) {
        const opts = { weekday:'short', day:'numeric', month:'long', year:'numeric' };
        const s = new Date().toLocaleDateString('fr-FR', opts);
        el.textContent = s.charAt(0).toUpperCase() + s.slice(1);
    }
})();

/* ── Chart.js palette ─────────────────────────────────────── */
const colors = {
    blue:   '#3b82f6',
    green:  '#22c55e',
    cyan:   '#06b6d4',
    amber:  '#f59e0b',
    red:    '#ef4444',
    purple: '#8b5cf6',
    teal:   '#14b8a6',
    slate:  '#64748b',
};

const months = ['Jan','Fév','Mar','Avr','Mai','Jun','Jul','Aoû','Sep','Oct','Nov','Déc'];

/* ── Bar Chart — Statistiques mensuelles ─────────────────── */
const barCtx = document.getElementById('monthlyChart');
if (barCtx) {
    new Chart(barCtx, {
        type: 'bar',
        data: {
            labels: months,
            datasets: [
                {
                    label: 'Emprunts',
                    data: [12,19,15,22,18,25,20,28,17,24,21,30],
                    backgroundColor: colors.blue + 'cc',
                    borderRadius: 6,
                    borderSkipped: false,
                },
                {
                    label: 'Retours',
                    data: [10,15,13,18,14,22,16,24,15,20,18,26],
                    backgroundColor: colors.green + 'cc',
                    borderRadius: 6,
                    borderSkipped: false,
                },
                {
                    label: 'Inscriptions',
                    data: [3,5,2,7,4,6,3,8,4,5,6,9],
                    backgroundColor: colors.amber + 'cc',
                    borderRadius: 6,
                    borderSkipped: false,
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                    labels: { font: { family: "'DM Sans'", size: 12 }, boxRadius: 4, padding: 16 }
                },
                tooltip: { mode: 'index', intersect: false }
            },
            scales: {
                x: {
                    grid: { display: false },
                    ticks: { font: { family: "'DM Sans'", size: 11 } }
                },
                y: {
                    grid: { color: '#f1f5f9' },
                    ticks: { font: { family: "'DM Sans'", size: 11 } }
                }
            }
        }
    });
}

/* ── Doughnut — Répartition ──────────────────────────────── */
const pieCtx = document.getElementById('pieChart');
if (pieCtx) {
    new Chart(pieCtx, {
        type: 'doughnut',
        data: {
            labels: ['Livres dispo.', 'Empruntés', 'En retard', 'Réservés'],
            datasets: [{
                data: [60, 25, 8, 7],
                backgroundColor: [colors.green, colors.blue, colors.red, colors.amber],
                borderWidth: 0,
                hoverOffset: 8,
            }]
        },
        options: {
            responsive: true,
            cutout: '68%',
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { font: { family: "'DM Sans'", size: 11 }, boxRadius: 4, padding: 12 }
                }
            }
        }
    });
}
</script>
{% endblock %}